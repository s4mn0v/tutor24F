import e from"node:process";globalThis._importMeta_=globalThis._importMeta_||{url:"file:///_entry.js",env:e.env};import{getRequestDependencies as t,getPreloadLinks as n,getPrefetchLinks as r,createRenderer as o}from"vue-bundle-renderer/runtime";import{i as s,j as a,p as i,g as l,c,k as u,u as p,l as d,m as f,n as h,r as m,o as y}from"../nitro/nitro.mjs";import{renderToString as g}from"vue/server-renderer";import{propsToString as b,renderSSRHead as $}from"@unhead/ssr";import{createServerHead as w,CapoPlugin as j}from"unhead";import{unref as v,version as x}from"vue";import{defineHeadPlugin as O}from"@unhead/shared";import"underscore";import"bluebird/js/release/promise";import"base64-js";import"jszip";import"@xmldom/xmldom";import"@xmldom/xmldom/lib/dom";import"xmlbuilder";import"dingbat-to-unicode";import"fs";import"url";import"os";import"path";import"path-is-absolute";import"pdf.js-extract";import"node:http";import"node:https";import"@vercel/kv";import"@iconify/utils";import"consola/core";const C="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_$",S=/[<>\b\f\n\r\t\0\u2028\u2029]/g,k=/^(?:do|if|in|for|int|let|new|try|var|byte|case|char|else|enum|goto|long|this|void|with|await|break|catch|class|const|final|float|short|super|throw|while|yield|delete|double|export|import|native|return|switch|throws|typeof|boolean|default|extends|finally|package|private|abstract|continue|debugger|function|volatile|interface|protected|transient|implements|instanceof|synchronized)$/,_={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},A=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function devalue(e){const t=new Map;let n=0;function log(e){n<100&&(console.warn(e),n+=1)}!function walk(e){if("function"!=typeof e){if(t.has(e))t.set(e,t.get(e)+1);else if(t.set(e,1),!isPrimitive(e)){switch(getType(e)){case"Number":case"String":case"Boolean":case"Date":case"RegExp":return;case"Array":e.forEach(walk);break;case"Set":case"Map":Array.from(e).forEach(walk);break;default:const t=Object.getPrototypeOf(e);t!==Object.prototype&&null!==t&&Object.getOwnPropertyNames(t).sort().join("\0")!==A?"function"!=typeof e.toJSON&&log(`Cannot stringify arbitrary non-POJOs ${e.constructor.name}`):Object.getOwnPropertySymbols(e).length>0?log(`Cannot stringify POJOs with symbolic keys ${Object.getOwnPropertySymbols(e).map((e=>e.toString()))}`):Object.keys(e).forEach((t=>walk(e[t])))}}}else log(`Cannot stringify a function ${e.name}`)}(e);const r=new Map;function stringify(e){if(r.has(e))return r.get(e);if(isPrimitive(e))return stringifyPrimitive(e);const t=getType(e);switch(t){case"Number":case"String":case"Boolean":return`Object(${stringify(e.valueOf())})`;case"RegExp":return e.toString();case"Date":return`new Date(${e.getTime()})`;case"Array":const n=e.map(((t,n)=>n in e?stringify(t):"")),r=0===e.length||e.length-1 in e?"":",";return`[${n.join(",")}${r}]`;case"Set":case"Map":return`new ${t}([${Array.from(e).map(stringify).join(",")}])`;default:if(e.toJSON){let t=e.toJSON();if("String"===getType(t))try{t=JSON.parse(t)}catch(e){}return stringify(t)}return null===Object.getPrototypeOf(e)?0===Object.keys(e).length?"Object.create(null)":`Object.create(null,{${Object.keys(e).map((t=>`${safeKey(t)}:{writable:true,enumerable:true,value:${stringify(e[t])}}`)).join(",")}})`:`{${Object.keys(e).map((t=>`${safeKey(t)}:${stringify(e[t])}`)).join(",")}}`}}Array.from(t).filter((e=>e[1]>1)).sort(((e,t)=>t[1]-e[1])).forEach(((e,t)=>{r.set(e[0],function(e){let t="";do{t=C[e%54]+t,e=~~(e/54)-1}while(e>=0);return k.test(t)?`${t}0`:t}(t))}));const o=stringify(e);if(r.size){const e=[],t=[],n=[];return r.forEach(((r,o)=>{if(e.push(r),isPrimitive(o))return void n.push(stringifyPrimitive(o));switch(getType(o)){case"Number":case"String":case"Boolean":n.push(`Object(${stringify(o.valueOf())})`);break;case"RegExp":n.push(o.toString());break;case"Date":n.push(`new Date(${o.getTime()})`);break;case"Array":n.push(`Array(${o.length})`),o.forEach(((e,n)=>{t.push(`${r}[${n}]=${stringify(e)}`)}));break;case"Set":n.push("new Set"),t.push(`${r}.${Array.from(o).map((e=>`add(${stringify(e)})`)).join(".")}`);break;case"Map":n.push("new Map"),t.push(`${r}.${Array.from(o).map((([e,t])=>`set(${stringify(e)}, ${stringify(t)})`)).join(".")}`);break;default:n.push(null===Object.getPrototypeOf(o)?"Object.create(null)":"{}"),Object.keys(o).forEach((e=>{t.push(`${r}${function(e){return/^[_$a-zA-Z][_$a-zA-Z0-9]*$/.test(e)?`.${e}`:`[${escapeUnsafeChars(JSON.stringify(e))}]`}(e)}=${stringify(o[e])}`)}))}})),t.push(`return ${o}`),`(function(${e.join(",")}){${t.join(";")}}(${n.join(",")}))`}return o}function isPrimitive(e){return Object(e)!==e}function stringifyPrimitive(e){if("string"==typeof e)return function(e){let t='"';for(let n=0;n<e.length;n+=1){const r=e.charAt(n),o=r.charCodeAt(0);if('"'===r)t+='\\"';else if(r in _)t+=_[r];else if(o>=55296&&o<=57343){const s=e.charCodeAt(n+1);t+=o<=56319&&s>=56320&&s<=57343?r+e[++n]:`\\u${o.toString(16).toUpperCase()}`}else t+=r}return t+='"',t}(e);if(void 0===e)return"void 0";if(0===e&&1/e<0)return"-0";const t=String(e);return"number"==typeof e?t.replace(/^(-)?0\./,"$1."):t}function getType(e){return Object.prototype.toString.call(e).slice(8,-1)}function escapeUnsafeChar(e){return _[e]||e}function escapeUnsafeChars(e){return e.replace(S,escapeUnsafeChar)}function safeKey(e){return/^[_$a-zA-Z][_$a-zA-Z0-9]*$/.test(e)?e:escapeUnsafeChars(JSON.stringify(e))}const T="3"===x[0];function resolveUnrefHeadInput(e){if(e instanceof Promise||e instanceof Date||e instanceof RegExp)return e;const t="function"==typeof(n=e)?n():v(n);var n;if(!e||!t)return t;if(Array.isArray(t))return t.map((e=>resolveUnrefHeadInput(e)));if("object"==typeof t){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&("titleTemplate"===n||"o"===n[0]&&"n"===n[1]?e[n]=v(t[n]):e[n]=resolveUnrefHeadInput(t[n]));return e}return t}const P=O({hooks:{"entries:resolve":e=>{for(const t of e.entries)t.resolvedInput=resolveUnrefHeadInput(t.input)}}});function createServerHead(e={}){const t=w(e);return t.use(P),t.install=function(e){return{install(t){T&&(t.config.globalProperties.$unhead=e,t.config.globalProperties.$head=e,t.provide("usehead",e))}}.install}(t),t}const R=[j({track:!0})],N={omitLineBreaks:!1},E={meta:[{name:"viewport",content:"width=device-width, initial-scale=1"},{charset:"utf-8"}],link:[{rel:"preload",href:"/_nuxt/@nuxt/ui-templates/dist/templates.min.css",as:"style"}],style:[],script:[],noscript:[]},U="div",M={id:"teleports"};globalThis.__buildAssetsURL=a,globalThis.__publicAssetsURL=i;const getClientManifest=()=>import("../build/client.manifest.mjs").then((e=>e.default||e)).then((e=>"function"==typeof e?e():e)),H=lazyCachedFunction((()=>import("../build/styles.mjs").then((e=>e.default||e)))),I=lazyCachedFunction((async()=>{const e=await getClientManifest();if(!e)throw new Error("client.manifest is not available");const t=await import("../build/server.mjs").then((e=>e.default||e));if(!t)throw new Error("Server bundle is not available");return o(t,{manifest:e,renderToString:async function(e,t){const n=await g(e,t);return B+n+Z},buildAssetsURL:a})})),z=lazyCachedFunction((async()=>{const e=await getClientManifest(),t=await import("../virtual/_virtual_spa-template.mjs").then((e=>e.template)).catch((()=>"")).then((e=>B+e+Z)),n=o((()=>()=>{}),{manifest:e,renderToString:()=>t,buildAssetsURL:a}),r=await n.renderToString({});return{rendererContext:n.rendererContext,renderToString:e=>{const t=p(e.event);return e.modules=e.modules||new Set,e.payload.serverRendered=!1,e.config={public:t.public,app:t.app},Promise.resolve(r)}}})),L=/\.json(\?.*)?$/;const J=!!M.id,D=J?`<div${b(M)}>`:"",F=J?"</div>":"",B=`<${U}${b({id:"__nuxt"})}>`,Z=`</${U}>`,K=/\/_payload.js(\?.*)?$/,q=new RegExp(`^<${U}[^>]*>([\\s\\S]*)<\\/${U}>$`),W=s((async e=>{const o=d(),s=e.path.startsWith("/__nuxt_error")?l(e):null;if(s&&s.statusCode&&(s.statusCode=Number.parseInt(s.statusCode)),s&&!("__unenv__"in e.node.req))throw c({statusCode:404,statusMessage:"Page Not Found: /__nuxt_error"});const i=e.path.startsWith("/__nuxt_island"),g=i?await async function(e){const t=(e.path||"").substring(15).replace(L,"").split("_"),n=t.length>1?t.pop():void 0,r=t.join("_"),o="GET"===e.method?l(e):await m(e);return{url:"/",...o,id:n,name:r,props:y(o.props)||{},slots:{},components:{}}}(e):void 0;let b=s?.url||g?.url||e.path;const w=K.test(b)&&!i;w&&(b=b.substring(0,b.lastIndexOf("/"))||"/",e._path=b,e.node.req.url=b);const j=u(e),v=createServerHead({plugins:R}),x={mode:"server"};i||v.push(E,x);const O={url:b,event:e,runtimeConfig:p(e),noSSR:e.context.nuxt?.noSSR||!1===j.ssr&&!i||!1,head:v,error:!!s,nuxt:void 0,payload:s?{error:s}:{},_payloadReducers:Object.create(null),modules:new Set,islandContext:g},C=O.noSSR?await z():await I(),S=await C.renderToString(O).catch((async e=>{if(O._renderResponse&&"skipping render"===e.message)return{};const t=!s&&O.payload?.error||e;throw await(O.nuxt?.hooks.callHook("app:error",t)),t}));if(await(O.nuxt?.hooks.callHook("app:rendered",{ssrContext:O,renderResult:S})),O._renderResponse)return O._renderResponse;if(O.payload?.error&&!s)throw O.payload.error;if(w){const e=function(e){return{body:`export default ${devalue(splitPayload(e).payload)}`,statusCode:h(e.event),statusMessage:f(e.event),headers:{"content-type":"text/javascript;charset=utf-8","x-powered-by":"Nuxt"}}}(O);return e}const k=i?await async function(e){const t=await H(),n=new Set;for(const r of e)if(r in t&&t[r])for(const e of await t[r]())n.add(e);return Array.from(n).map((e=>({innerHTML:e})))}(O.modules??[]):[],_=j.experimentalNoScripts,{styles:A,scripts:T}=t(O,C.rendererContext);if(O._preloadManifest&&v.push({link:[{rel:"preload",as:"fetch",fetchpriority:"low",crossorigin:"anonymous",href:a(`builds/meta/${O.runtimeConfig.app.buildId}.json`)}]},{...x,tagPriority:"low"}),k.length&&v.push({style:k}),!i){const e=[];for(const t of Object.values(A))e.push({rel:"stylesheet",href:C.rendererContext.buildAssetsURL(t.file),crossorigin:""});e.length&&v.push({link:e},x)}_||i||(v.push({link:n(O,C.rendererContext)},x),v.push({link:r(O,C.rendererContext)},x),v.push({script:renderPayloadScript({ssrContext:O,data:O.payload})},{...x,tagPosition:"bodyClose",tagPriority:"high"})),j.experimentalNoScripts||i||v.push({script:Object.values(T).map((e=>({type:e.module?"module":null,src:C.rendererContext.buildAssetsURL(e.file),defer:!e.module||null,tagPosition:"head",crossorigin:""})))},x);const{headTags:P,bodyTags:U,bodyTagsOpen:B,htmlAttrs:Z,bodyAttrs:q}=await $(v,N),W={island:i,htmlAttrs:Z?[Z]:[],head:normalizeChunks([P]),bodyAttrs:q?[q]:[],bodyPrepend:normalizeChunks([B,O.teleports?.body]),body:[replaceIslandTeleports(O,S.html),D+(J?joinTags([O.teleports?.[`#${M.id}`]]):"")+F],bodyAppend:[U]};if(await o.hooks.callHook("render:html",W,{event:e}),i&&g){const t={};for(const e of v.headEntries())for(const[n,r]of Object.entries(resolveUnrefHeadInput(e.input))){const e=t[n];Array.isArray(e)&&e.push(...r),t[n]=r}t.link||=[],t.style||=[];const n={id:g.id,head:t,html:getServerComponentHTML(W.body),components:getClientIslandResponse(O),slots:getSlotIslandResponse(O)};await o.hooks.callHook("render:island",n,{event:e,islandContext:g});return{body:JSON.stringify(n,null,2),statusCode:h(e),statusMessage:f(e),headers:{"content-type":"application/json;charset=utf-8","x-powered-by":"Nuxt"}}}var G;return{body:(G=W,`<!DOCTYPE html><html${joinAttrs(G.htmlAttrs)}><head>${joinTags(G.head)}</head><body${joinAttrs(G.bodyAttrs)}>${joinTags(G.bodyPrepend)}${joinTags(G.body)}${joinTags(G.bodyAppend)}</body></html>`),statusCode:h(e),statusMessage:f(e),headers:{"content-type":"text/html;charset=utf-8","x-powered-by":"Nuxt"}}}));function lazyCachedFunction(e){let t=null;return()=>(null===t&&(t=e().catch((e=>{throw t=null,e}))),t)}function normalizeChunks(e){return e.filter(Boolean).map((e=>e.trim()))}function joinTags(e){return e.join("")}function joinAttrs(e){return 0===e.length?"":" "+e.join(" ")}function renderPayloadScript(e){e.data.config=e.ssrContext.config;const t=devalue(e.data),n=`window.__NUXT__=${t}`;return JSON.stringify("nuxt-app"),[{innerHTML:n}]}function splitPayload(e){const{data:t,prerenderedAt:n,...r}=e.payload;return{initial:{...r,prerenderedAt:n},payload:{data:t,prerenderedAt:n}}}function getServerComponentHTML(e){const t=e[0].match(q);return t?.[1]||e[0]}const G=/^uid=([^;]*);slot=(.*)$/,X=/^uid=([^;]*);client=(.*)$/,Y=/^island-slot=[^;]*;(.*)$/;function getSlotIslandResponse(e){if(!e.islandContext||!Object.keys(e.islandContext.slots).length)return;const t={};for(const[n,r]of Object.entries(e.islandContext.slots))t[n]={...r,fallback:e.teleports?.[`island-fallback=${n}`]};return t}function getClientIslandResponse(e){if(!e.islandContext||!Object.keys(e.islandContext.components).length)return;const t={};for(const[n,r]of Object.entries(e.islandContext.components)){const o=e.teleports?.[n]?.replaceAll("\x3c!--teleport start anchor--\x3e","")||"";t[n]={...r,html:o,slots:getComponentSlotTeleport(e.teleports??{})}}return t}function getComponentSlotTeleport(e){const t=Object.entries(e),n={};for(const[e,r]of t){const t=e.match(Y);if(t){const[,e]=t;if(!e)continue;n[e]=r}}return n}function replaceIslandTeleports(e,t){const{teleports:n,islandContext:r}=e;if(r||!n)return t;for(const e in n){const r=e.match(X);if(r){const[,o,s]=r;if(!o||!s)continue;t=t.replace(new RegExp(` data-island-uid="${o}" data-island-component="${s}"[^>]*>`),(t=>t+n[e]));continue}const o=e.match(G);if(o){const[,r,s]=o;if(!r||!s)continue;t=t.replace(new RegExp(` data-island-uid="${r}" data-island-slot="${s}"[^>]*>`),(t=>t+n[e]))}}return t}export{W as default};
//# sourceMappingURL=renderer.mjs.map
