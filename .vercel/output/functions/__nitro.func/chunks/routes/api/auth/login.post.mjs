import{PrismaClient as r}from"@prisma/client";import e from"bcryptjs";import t from"jsonwebtoken";import{d as a,r as s,c as o}from"../../../nitro/nitro.mjs";import"mammoth";import"pdf.js-extract";import"node:http";import"node:https";import"@vercel/kv";import"@iconify/utils";import"consola/core";const n=new r,i=a((async r=>{const a=await s(r),{email:i,password:c}=a;try{const r=await n.usuario.findUnique({where:{correo:i},select:{id:!0,contrasena:!0,rol:!0}});if(r){if(!await e.compare(c,r.contrasena))return o({statusCode:401,message:"Invalid credentials"});return{token:t.sign({userId:r.id,role:r.rol},process.env.JWT_SECRET||"fallback_secret",{expiresIn:"1h"}),role:r.rol,userId:r.id}}const a=await n.estudiante.findUnique({where:{correo:i},select:{id:!0,contrasena:!0,asignaturaId:!0}});if(a){if(!await e.compare(c,a.contrasena))return o({statusCode:401,message:"Invalid credentials"});return{token:t.sign({userId:a.id,role:"ESTUDIANTE",asignaturaId:a.asignaturaId},process.env.JWT_SECRET||"fallback_secret",{expiresIn:"1h"}),role:"ESTUDIANTE",asignaturaId:a.asignaturaId,userId:a.id}}return o({statusCode:401,message:"Invalid credentials"})}catch(r){return console.error("Login error:",r),o({statusCode:500,message:"Internal server error"})}}));export{i as default};
//# sourceMappingURL=login.post.mjs.map
