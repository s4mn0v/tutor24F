import{PrismaClient as t}from"@prisma/client";import{d as o,e as r,c as e}from"../../../nitro/nitro.mjs";import i from"jsonwebtoken";import"underscore";import"bluebird/js/release/promise";import"base64-js";import"jszip";import"@xmldom/xmldom";import"@xmldom/xmldom/lib/dom";import"xmlbuilder";import"dingbat-to-unicode";import"fs";import"url";import"os";import"path";import"path-is-absolute";import"pdf.js-extract";import"node:http";import"node:https";import"@vercel/kv";import"@iconify/utils";import"consola/core";const a=new t,s=o((async t=>{try{const o=r(t,"authorization");if(!o||!o.startsWith("Bearer "))throw e({statusCode:401,message:"No se proporcion칩 un token de autenticaci칩n v치lido"});const s=o.split(" ")[1],n=process.env.JWT_SECRET||"fallback_secret";let d;try{d=i.verify(s,n)}catch(t){throw e({statusCode:401,message:"Token inv치lido o expirado"})}const m=await a.estudiante.findUnique({where:{id:d.userId},include:{asignatura:{include:{recordatorios:{orderBy:{fecha:"asc"},select:{id:!0,titulo:!0,descripcion:!0,fecha:!0,asignatura:{select:{id:!0,nombre:!0}}}}}}}});if(!m)return{eventos:[],asignaturas:[]};const c=m.asignatura.recordatorios.map((t=>({id:t.id,title:t.titulo,date:t.fecha.toISOString(),description:t.descripcion,asignatura:{id:t.asignatura.id,nombre:t.asignatura.nombre}})));return{eventos:c,asignaturas:[{id:m.asignatura.id,nombre:m.asignatura.nombre}]}}catch(t){throw console.error("Error al obtener eventos del calendario:",t),e({statusCode:500,message:"Error al obtener los eventos del calendario",cause:t})}}));export{s as default};
//# sourceMappingURL=calendar.get.mjs.map
