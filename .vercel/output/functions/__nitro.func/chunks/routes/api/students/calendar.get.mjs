import{PrismaClient as t}from"@prisma/client";import{d as e,e as o,c as r}from"../../../nitro/nitro.mjs";import a from"jsonwebtoken";import"mammoth";import"pdf.js-extract";import"node:http";import"node:https";import"@vercel/kv";import"@iconify/utils";import"consola/core";const i=new t,s=e((async t=>{try{const e=o(t,"authorization");if(!e||!e.startsWith("Bearer "))throw r({statusCode:401,message:"No se proporcion칩 un token de autenticaci칩n v치lido"});const s=e.split(" ")[1],n=process.env.JWT_SECRET||"fallback_secret";let c;try{c=a.verify(s,n)}catch(t){throw r({statusCode:401,message:"Token inv치lido o expirado"})}const d=await i.estudiante.findUnique({where:{id:c.userId},include:{asignatura:{include:{recordatorios:{orderBy:{fecha:"asc"},select:{id:!0,titulo:!0,descripcion:!0,fecha:!0,asignatura:{select:{id:!0,nombre:!0}}}}}}}});if(!d)return{eventos:[],asignaturas:[]};const u=d.asignatura.recordatorios.map((t=>({id:t.id,title:t.titulo,date:t.fecha.toISOString(),description:t.descripcion,asignatura:{id:t.asignatura.id,nombre:t.asignatura.nombre}})));return{eventos:u,asignaturas:[{id:d.asignatura.id,nombre:d.asignatura.nombre}]}}catch(t){throw console.error("Error al obtener eventos del calendario:",t),r({statusCode:500,message:"Error al obtener los eventos del calendario",cause:t})}}));export{s as default};
//# sourceMappingURL=calendar.get.mjs.map
