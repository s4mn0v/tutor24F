import{PrismaClient as o}from"@prisma/client";import{d as t,f as r,c as e,h as a}from"../../../nitro/nitro.mjs";import i from"jsonwebtoken";import"mammoth";import"pdf.js-extract";import"node:http";import"node:https";import"@vercel/kv";import"@iconify/utils";import"consola/core";const n=new o,s=t((async o=>{var t;try{const s=(null==(t=r(o).authorization)?void 0:t.split(" ")[1])||"";if(!s)throw e({statusCode:401,message:"Acceso no autorizado"});const m=i.verify(s,process.env.JWT_SECRET||"fallback_secret"),p=await n.material.findMany({where:{idAsignatura:m.asignaturaId,tipo:{in:["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation"]}},select:{id:!0,nombre:!0,tipo:!0,creadoEn:!0,url:!0}});return await Promise.all(p.map((async o=>({...o,creadoEn:o.creadoEn.toISOString(),topics:await a(o.url,o.tipo)}))))}catch(o){throw console.error("Error:",o),e({statusCode:500,message:"Error al obtener materiales"})}}));export{s as default};
//# sourceMappingURL=materials.get.mjs.map
