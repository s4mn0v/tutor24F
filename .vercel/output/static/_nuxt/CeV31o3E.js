import e from"./MFsz-r7O.js";import l from"./CHXTBSQj.js";import o from"./BkS5hAU1.js";import a from"./qpKX9jtC.js";import r from"./LVTZ1MR-.js";import t from"./D7s0IBLH.js";import n from"./Ban32Nb9.js";import{f as u,r as s,c as d,o as i,w as m,b as c,h as p,e as f,i as v,t as b,k as y,j as h}from"./y4QvXspP.js";import g from"./ChLDmpPc.js";import j from"./fHUgzazi.js";import V from"./B3_2zXUT.js";import"./BEP5_JP-.js";import"./D5749dPv.js";import"./D0xtSe3C.js";import"./Bfxjojwb.js";import"./Ch5OrHHS.js";import"./BsUv8T9A.js";import"./CcWMAPI5.js";import"./CHOj1P8S.js";import"./N1GbHz2C.js";import"./Cq5CFOCe.js";import"./BFnrRPax.js";import"./E-EL6i1g.js";import"./b_2Iuj5n.js";import"./CLukktBK.js";import"./DSObW8YX.js";import"./B_t2eSKp.js";import"./rGk_6fuN.js";import"./B3WgecHe.js";import"./C3eNCTn-.js";import"./BmYt0hqU.js";import"./BJht0Fqd.js";import"./BQWut4pg.js";import"./Bg0KYS7B.js";import"./C5xfyGX2.js";import"./B_0YXuDZ.js";import"./chI-DJON.js";import"./Yfl05yA4.js";import"./CGY6ERjo.js";import".prisma/client/index-browser";const k={key:0},_={key:1},w={key:2},C={class:"flex justify-end gap-3"},U=u({__name:"DeleteModal",props:{user:{type:Object,required:!1,default:()=>null},selectedUsers:{type:Array,required:!1,default:()=>[]}},emits:["confirm"],setup(l,{expose:o,emit:a}){const r=l,u=a,y=s(!1),h=()=>{y.value=!1},g=()=>{r.user?u("confirm",r.user):r.selectedUsers.length>0&&u("confirm",r.selectedUsers),h()};return o({openModalDelete:()=>{y.value=!0},closeModal:h}),(o,a)=>{const r=e,u=t,s=n;return i(),d(s,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e)},{default:m((()=>[c(u,null,{header:m((()=>a[1]||(a[1]=[v("h3",{class:"text-lg font-semibold"},"Confirmar Eliminación",-1)]))),footer:m((()=>[v("div",C,[c(r,{color:"gray",onClick:h},{default:m((()=>a[6]||(a[6]=[f("Cancelar")]))),_:1}),c(r,{color:"red",onClick:g},{default:m((()=>a[7]||(a[7]=[f("Eliminar")]))),_:1})])])),default:m((()=>[l.user?(i(),p("p",k,[a[2]||(a[2]=f("¿Estás seguro de que deseas eliminar a ")),v("strong",null,b(l.user.nombre),1),a[3]||(a[3]=f("?"))])):l.selectedUsers.length>0?(i(),p("p",_,[a[4]||(a[4]=f(" ¿Estás seguro de que deseas eliminar a los ")),v("strong",null,b(l.selectedUsers.length),1),a[5]||(a[5]=f(" usuarios seleccionados? "))])):(i(),p("p",w,"No se ha seleccionado ningún usuario para eliminar."))])),_:1})])),_:1},8,["modelValue"])}}}),D={key:1},x=u({__name:"EditModal",props:{user:{type:Object,required:!0}},emits:["submit"],setup(o,{expose:a,emit:r}){const u=o,b=r,h=s(!1),k=s(""),_=s(""),w=e=>!!e||"Este campo es requerido.",C=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"Correo electrónico no válido.",U=()=>{h.value=!1,_.value=""},x=e=>{/[0-9]/.test(e.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(e.key)||e.preventDefault()},E=e=>{/[a-zA-Z0-9@._-]/.test(e.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(e.key)||e.preventDefault()},I=async()=>{const{user:e}=u;try{if(!(e.nombre&&e.correo&&e.telefono&&e.documentoIdentidad))return void(_.value="Todos los campos son requeridos, excepto la contraseña.");const l={...e};k.value&&(l.contrasena=k.value),b("submit",l),U()}catch(l){let e="Ocurrió un error al actualizar el usuario.";if("object"==typeof l&&null!==l&&"message"in l){const o=l.message.match(/:\s*\d+\s*(.*)/);o&&o[1]&&(e=o[1].trim())}_.value=e}};return a({openModalEdit:()=>{h.value=!0,k.value=""},closeModal:U,error:_}),(a,r)=>{const u=g,s=l,b=j,U=e,q=V,M=t,T=n;return i(),d(T,{modelValue:h.value,"onUpdate:modelValue":r[6]||(r[6]=e=>h.value=e)},{default:m((()=>[c(M,null,{header:m((()=>r[7]||(r[7]=[v("h3",{class:"text-lg font-semibold"},"Editar Usuario",-1)]))),default:m((()=>[_.value?(i(),d(u,{key:0,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"gray",variant:"link",padded:!1},title:_.value,color:"red",onClose:r[0]||(r[0]=e=>_.value=""),variant:"outline"},null,8,["title"])):y("",!0),_.value?(i(),p("br",D)):y("",!0),c(q,{state:o.user,onSubmit:I},{default:m((()=>[c(b,{label:"Nombre",name:"nombre",required:""},{default:m((()=>[c(s,{modelValue:o.user.nombre,"onUpdate:modelValue":r[1]||(r[1]=e=>o.user.nombre=e),rules:[w]},null,8,["modelValue","rules"])])),_:1}),r[9]||(r[9]=v("br",null,null,-1)),c(b,{label:"Correo",name:"correo",required:""},{default:m((()=>[c(s,{modelValue:o.user.correo,"onUpdate:modelValue":r[2]||(r[2]=e=>o.user.correo=e),type:"email",rules:[w,C],onKeydown:E},null,8,["modelValue","rules"])])),_:1}),r[10]||(r[10]=v("br",null,null,-1)),c(b,{label:"Teléfono",name:"telefono",required:""},{default:m((()=>[c(s,{modelValue:o.user.telefono,"onUpdate:modelValue":r[3]||(r[3]=e=>o.user.telefono=e),type:"tel",rules:[w],onKeydown:x},null,8,["modelValue","rules"])])),_:1}),r[11]||(r[11]=v("br",null,null,-1)),c(b,{label:"Documento",name:"documentoIdentidad",required:""},{default:m((()=>[c(s,{modelValue:o.user.documentoIdentidad,"onUpdate:modelValue":r[4]||(r[4]=e=>o.user.documentoIdentidad=e),type:"text",rules:[w],onKeydown:x},null,8,["modelValue","rules"])])),_:1}),r[12]||(r[12]=v("br",null,null,-1)),c(b,{label:"Contraseña",name:"contrasena"},{default:m((()=>[c(s,{modelValue:k.value,"onUpdate:modelValue":r[5]||(r[5]=e=>k.value=e),type:"password",placeholder:"Dejar en blanco para no cambiar"},null,8,["modelValue"])])),_:1}),r[13]||(r[13]=v("br",null,null,-1)),c(U,{type:"submit"},{default:m((()=>r[8]||(r[8]=[f("Guardar")]))),_:1})])),_:1},8,["state"])])),_:1})])),_:1},8,["modelValue"])}}}),E={key:1},I={class:"flex justify-end gap-3 mt-4"},q=u({__name:"CreateTeacherModal",emits:["created"],setup(o,{expose:a,emit:r}){const u=r,b=s(!1),h=s({documentoIdentidad:"",nombre:"",correo:"",telefono:"",contrasena:""}),k=s(""),_=()=>{b.value=!1,w(),k.value=""},w=()=>{h.value={documentoIdentidad:"",nombre:"",correo:"",telefono:"",contrasena:""}},C=e=>{/[0-9]/.test(e.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(e.key)||e.preventDefault()},U=e=>{/[a-zA-Z0-9@._-]/.test(e.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(e.key)||e.preventDefault()},D=async()=>{try{await $fetch("/api/admin/users",{method:"POST",body:h.value});_(),u("created")}catch(e){let l="Ocurrió un error al crear el docente.";if("object"==typeof e&&null!==e&&"message"in e){const o=e.message.match(/:\s*\d+\s*(.*)/);o&&o[1]&&(l=o[1].trim())}k.value=l}};return a({openModalCreate:()=>{b.value=!0},closeModal:_}),(o,a)=>{const r=g,u=l,s=j,w=e,x=V,q=t,M=n;return i(),d(M,{modelValue:b.value,"onUpdate:modelValue":a[6]||(a[6]=e=>b.value=e)},{default:m((()=>[c(q,null,{header:m((()=>a[7]||(a[7]=[v("h3",{class:"text-lg font-semibold"},"Crear Nuevo Docente",-1)]))),default:m((()=>[k.value?(i(),d(r,{key:0,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"gray",variant:"link",padded:!1},title:k.value,color:"red",onClose:a[0]||(a[0]=e=>k.value=""),variant:"outline"},null,8,["title"])):y("",!0),k.value?(i(),p("br",E)):y("",!0),c(x,{state:h.value,onSubmit:D},{default:m((()=>[c(s,{label:"Documento de Identidad",name:"documentoIdentidad",required:""},{default:m((()=>[c(u,{modelValue:h.value.documentoIdentidad,"onUpdate:modelValue":a[1]||(a[1]=e=>h.value.documentoIdentidad=e),placeholder:"Ingrese el documento",onKeydown:C,maxlength:"10"},null,8,["modelValue"])])),_:1}),a[10]||(a[10]=v("br",null,null,-1)),c(s,{label:"Nombre",name:"nombre",required:""},{default:m((()=>[c(u,{modelValue:h.value.nombre,"onUpdate:modelValue":a[2]||(a[2]=e=>h.value.nombre=e),placeholder:"Ingrese el nombre"},null,8,["modelValue"])])),_:1}),a[11]||(a[11]=v("br",null,null,-1)),c(s,{label:"Correo Electrónico",name:"correo",required:""},{default:m((()=>[c(u,{modelValue:h.value.correo,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value.correo=e),type:"email",placeholder:"Ingrese el correo",onKeydown:U,maxlength:"40"},null,8,["modelValue"])])),_:1}),a[12]||(a[12]=v("br",null,null,-1)),c(s,{label:"Teléfono",name:"telefono"},{default:m((()=>[c(u,{modelValue:h.value.telefono,"onUpdate:modelValue":a[4]||(a[4]=e=>h.value.telefono=e),placeholder:"Ingrese el teléfono",onKeydown:C,maxlength:"10"},null,8,["modelValue"])])),_:1}),a[13]||(a[13]=v("br",null,null,-1)),c(s,{label:"Contraseña",name:"contrasena",required:""},{default:m((()=>[c(u,{modelValue:h.value.contrasena,"onUpdate:modelValue":a[5]||(a[5]=e=>h.value.contrasena=e),type:"password",placeholder:"Ingrese la contraseña",minlength:"8"},null,8,["modelValue"])])),_:1}),a[14]||(a[14]=v("br",null,null,-1)),v("div",I,[c(w,{type:"button",color:"gray",onClick:_},{default:m((()=>a[8]||(a[8]=[f("Cancelar")]))),_:1}),c(w,{type:"submit",color:"primary"},{default:m((()=>a[9]||(a[9]=[f("Crear Docente")]))),_:1})])])),_:1},8,["state"])])),_:1})])),_:1},8,["modelValue"])}}}),M={class:"flex justify-end"},T={class:"flex justify-end px-3 py-3.5 border-t border-gray-200 dark:border-gray-700"},A=u({__name:"TableTeacher",setup(n){const u=s([]),p=s({documentoIdentidad:"",nombre:"",correo:"",telefono:"",id:0,rol:"",contrasena:""}),f=s(""),b=s(1),g=s(50),j=s(!1),V=s([]),k=s(0),_=s(null),w=s(null),C=s(null),D=s(null),E=[{key:"",label:""},{key:"documentoIdentidad",label:"Documento"},{key:"nombre",label:"Nombre"},{key:"correo",label:"Correo"},{key:"telefono",label:"Teléfono"},{key:"actions",label:"Acciones"}],I=async()=>{j.value=!0;const e=await $fetch("/api/admin/users",{query:{page:b.value,limit:g.value,search:f.value.toLocaleLowerCase()}}),{users:l,total:o}=e;V.value=l.map((e=>({...e,telefono:e.telefono||""}))),k.value=o,j.value=!1};h([b,f],I,{immediate:!0});const A=e=>[[{label:"Editar",icon:"i-heroicons-pencil-square-20-solid",click:()=>{var l;p.value={...e},null==(l=C.value)||l.openModalEdit()}}],[{label:"Eliminar",icon:"i-heroicons-trash-20-solid",click:()=>{var l;_.value=e,null==(l=w.value)||l.openModalDelete()}}]],L=async e=>{try{await $fetch("/api/admin/users",{method:"PUT",body:{id:e.id,nombre:e.nombre,correo:e.correo,telefono:e.telefono||"",documentoIdentidad:e.documentoIdentidad,contrasena:e.contrasena||void 0}});I()}catch(l){}},N=async e=>{try{if(Array.isArray(e)){const l=e.map((e=>e.id));await $fetch("/api/admin/select/users",{method:"DELETE",body:{ids:l}})}else{await $fetch("/api/admin/users",{method:"DELETE",body:{id:e.id}})}I(),u.value=[],_.value=null}catch(l){}},B=()=>{var e;u.value.length>0&&(null==(e=w.value)||e.openModalDelete())},K=()=>{var e;null==(e=D.value)||e.openModalCreate()};return(n,s)=>{const h=e,$=l,z=o,O=a,R=r,S=t;return i(),d(S,null,{default:m((()=>[v("div",M,[c(h,{onClick:K,color:"primary",class:"mb-4",icon:"i-heroicons-plus-circle-20-solid"})]),c($,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=e=>f.value=e),placeholder:"Buscar por nombre, correo, teléfono o documento..."},null,8,["modelValue"]),u.value.length>0?(i(),d(h,{key:0,disabled:0===u.value.length,onClick:B,color:"red",variant:"outline",class:"mt-4",icon:"i-heroicons-trash-20-solid",title:"Eliminar seleccionados"},null,8,["disabled"])):y("",!0),s[3]||(s[3]=v("br",null,null,-1)),c(O,{rows:V.value,columns:E,loading:j.value,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},progress:{color:"primary",animation:"carousel"},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"No items."},modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=e=>u.value=e)},{"actions-data":m((({row:e})=>[c(z,{items:A(e)},{default:m((()=>[c(h,{color:"gray",variant:"ghost",icon:"i-heroicons-ellipsis-horizontal-20-solid"})])),_:2},1032,["items"])])),_:1},8,["rows","loading","modelValue"]),v("div",T,[c(R,{modelValue:b.value,"onUpdate:modelValue":s[2]||(s[2]=e=>b.value=e),"page-count":g.value,total:k.value},null,8,["modelValue","page-count","total"])]),c(x,{ref_key:"editModal",ref:C,user:p.value,onSubmit:L},null,8,["user"]),c(U,{ref_key:"deleteModal",ref:w,user:_.value,selectedUsers:u.value,onConfirm:N},null,8,["user","selectedUsers"]),c(q,{ref_key:"createTeacherModal",ref:D,onCreated:I},null,512)])),_:1})}}}),L={__name:"docentes",setup:e=>(e,l)=>(i(),p("div",null,[v("div",null,[c(A)])]))};export{L as default};
