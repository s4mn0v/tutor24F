import{_ as t,f as e,h as r,o as a,P as n,a4 as s,a5 as i,y as u,r as o,g as l,D as c,ay as f,X as p,L as m}from"./y4QvXspP.js";import{e as v}from"./BmYt0hqU.js";import"./CGY6ERjo.js";import".prisma/client/index-browser";class d extends Error{constructor(t){super(t),this.message=t,Object.setPrototypeOf(this,d.prototype)}}const h=t(e({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(t,{expose:e,emit:r}){const a=p(),n=v(`form-${a}`),s=o(null);l((()=>{n.on((async e=>{var r;"submit"!==e.type&&(null==(r=t.validateOn)?void 0:r.includes(e.type))&&await y(e.path,{silent:!0})}))})),c((()=>{n.reset()}));const i=o([]);m("form-errors",i),m("form-events",n);const u=o({});async function h(){let e=await t.validate(t.state);if(t.schema){const{errors:r,result:a}=await function(t,e){if(function(t){return void 0!==t.parse}(e))return async function(t,e){const r=await e.safeParseAsync(t);if(!1===r.success){return{errors:r.error.issues.map((t=>({path:t.path.join("."),message:t.message}))),result:null}}return{result:r.data,errors:null}}(t,e);if(function(t){return void 0!==t.validateAsync&&void 0!==t.id}(e))return async function(t,e){try{return{errors:null,result:await e.validateAsync(t,{abortEarly:!1})}}catch(r){if(function(t){return!0===t.isJoi}(r)){return{errors:r.details.map((t=>({path:t.path.join("."),message:t.message}))),result:null}}throw r}}(t,e);if(function(t){return"_parse"in t||"_run"in t||"function"==typeof t&&"schema"in t}(e))return async function(t,e){const r=await("_parse"in e?e._parse(t):"_run"in e?e._run({typed:!1,value:t},{}):e(t));if(!r.issues||0===r.issues.length){return{errors:null,result:"output"in r?r.output:"value"in r?r.value:null}}const a=r.issues.map((t=>{var e;return{path:(null==(e=t.path)?void 0:e.map((t=>t.key)).join("."))||"",message:t.message}}));return{errors:a,result:null}}(t,e);if(function(t){return t.validate&&t.__isYupSchema__}(e))return async function(t,e){try{return{errors:null,result:await e.validate(t,{abortEarly:!1})}}catch(r){if(function(t){return void 0!==t.inner}(r)){return{errors:r.inner.map((t=>({path:t.path??"",message:t.message}))),result:null}}throw r}}(t,e);if(function(t){return"schema"in t&&"function"==typeof t.coercer&&"function"==typeof t.validator&&"function"==typeof t.refiner}(e))return async function(t,e){const[r,a]=e.validate(t);if(r){return{errors:r.failures().map((t=>({message:t.message,path:t.path.join(".")}))),result:null}}return{errors:null,result:a}}(t,e);throw new Error("Form validation failed: Unsupported form schema")}(t.state,t.schema);r?e=e.concat(r):s.value=a}return e}async function y(e,r={silent:!1}){let a=e;if(e&&!Array.isArray(e)&&(a=[e]),a){const t=i.value.filter((t=>!a.includes(t.path))),e=(await h()).filter((t=>a.includes(t.path)));i.value=t.concat(e)}else i.value=await h();if(i.value.length>0){if(r.silent)return!1;throw new d(`Form validation failed: ${JSON.stringify(i.value,null,2)}`)}return t.state}async function w(e){var a;const n=e;try{(null==(a=t.validateOn)?void 0:a.includes("submit"))&&await y(),n.data=t.schema?s.value:t.state,r("submit",n)}catch(o){if(!(o instanceof d))throw o;const t={...n,errors:i.value.map((t=>({...t,id:u.value[t.path]})))};r("error",t)}}return m("form-inputs",u),e({validate:y,errors:i,setErrors(t,e){i.value=e?i.value.filter((t=>t.path!==e)).concat(t):t},async submit(){await w(new Event("submit"))},getErrors:t=>t?i.value.filter((e=>e.path===t)):i.value,clear(t){i.value=t?i.value.filter((e=>e.path!==t)):[]}}),{onSubmit:w,errors:f(i)}}}),[["render",function(t,e,o,l,c,f){return a(),r("form",{onSubmit:e[0]||(e[0]=u(((...e)=>t.onSubmit&&t.onSubmit(...e)),["prevent"]))},[n(t.$slots,"default",s(i({errors:t.errors})))],32)}]]);export{h as default};
